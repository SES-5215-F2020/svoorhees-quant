---
title: "Assignmnet5_quant"
author: "Sage Grey"
date: "9/27/2020"
Name: "Sage Voorhees"
output:
  html_document:
    toc: yes
    toc_depth: 3
    toc_float: yes
    theme: cosmo
code_folding: hide
---

## Overview of Assignment

The intention of Assignment 5 is to experiment with alternate ways to fit a model. 

For this assignment, I wanted to filter my dataset to get closer at my area of interest --> Development in Bernallilo County. 
Also for the sake of learning more about regressions and best fit, I have decided to compress building type into a binary variable of "SIngle-Family Home" and "Not a single family home."



I'm holding changes made in my last assignment constant which were: 
1. Combining Race and Ethnicity.
2. Combining apartment types into condensed categories.
3. Binning Construction Dates into 20 year intervals




## House Keeping

#### Loading Libraries
```{r, message = FALSE, results='hide'}
library(tidyverse)
library(tidycensus)
library(ggplot2)
library(ggthemes)
library(plyr)
library(epiDisplay)
library(dplyr)
library(gridExtra)
```


#### **Code written in separate file (trying to limit the Data Consumption of R)**
> New_Mexico_Vars_Development <- get_pums(variables = c("YBL", 
                                          "HINCP",
                                          "RAC1P", 
                                          "JWMNP",
                                          "NP", 
                                          "PUMA",
                                          "HISP", 
                                          "AGEP", 
                                          "BLD",
                                          "PINCP"),
                state= "NM",
                year =2018,
                survey ="acs1",
                recode=TRUE) %>%
                mutate(PUMA = as.numeric(PUMA))%>%
                filter(PUMA> 00100 & PUMA <01200)%>%
                filter(HINCP >0)%>%
  
 >dplyr::select(HINCP, RAC1P, JWMNP, NP, PUMA, HISP, AGEP, BLD, PINCP)
  
  >write_csv(New_Mexico_Vars_Development, "New_Mexico_Vars_Development")



#####  **Load Household Data Set & Shortening Vars**


*Question for grader*:

1. In my data set, 14 people are being coded as "other". When I sleuth through my dataset, I see that they are all Two or More Races & Non-Hispanic. 
In my understanding, line 160 should be covering them,  *RAC1P_label == "Two or More Races" & HISP_label == "Not Spanish/Hispanic/Latino" ~ "Other Race or Multiracial (NH)",* There is probably an error I am not seeing, but can you help me see it? 


2. Carole gave me a great note on how to use the RAC1P & HISP variables instead of the RAC1P_label & HISP_labels to clean up this code. I have not had time to do so, but will do soon. 
```{r, message = FALSE, results='hide'}

#Load DataSet from CSV

assignment4_vars <- read_csv("New_Mexico_Vars_Development")
assignment5_vars <- read_csv("New_Mexico_Vars_Development")
  

assignment5_vars <-assignment5_vars %>%
  
 #Filter for Only Bernallilo COunty 
  filter(PUMA == 00700|
         PUMA == 00801|
         PUMA == 00802|
         PUMA == 00803|
         PUMA == 00804| 
         PUMA == 00805|
         PUMA == 00806) %>%
  
  
  
#Mutate Building Type
  mutate(bld_type =case_when(
                        BLD_label == "One-family house detached" ~ "1fam_home",
                        BLD_label == "One-family house attached" ~ "1fam_home",
                        BLD_label == "2 Apartments" ~ "other home type",
                        BLD_label == "Mobile home or trailer" ~ "other home type",
                        BLD_label == "3-4 Apartments" ~ "other home type",
                        BLD_label == "5-9 Apartments" ~ "other home type",
                        BLD_label == "10-19 Apartments" ~ "other home type",
                        BLD_label == "20-49 Apartments" ~ "other home type",
                        BLD_label == "50 or more apartments" ~ "other home type", 
                        BLD_label == "Boat, RV, van, etc." ~"other home type",
                        TRUE ~ "Other" )) %>%
  
#Mutate YBL to Decade House Was Built
  mutate(when_built = case_when(
                        YBL_label == "1939 or earlier" ~ "1 pre 1940", 
                        YBL_label == "1940 to 1949" ~ "1.2 40s/50s",
                        YBL_label == "1950 to 1959" ~ "1.2 40s/50s",
                        YBL_label == "1960 to 1969" ~ "1.3 60s/70s",
                        YBL_label == "1970 to 1979" ~ "1.3 60s/70s",
                        YBL_label == "1980 to 1989" ~ "1.4 80s/90s",
                        YBL_label == "1990 to 1999" ~ "1.4 80s/90s",
                        YBL_label == "2000 to 2004" ~ "2000s/10s",
                        YBL_label == "2005"~ "2000s/10s" ,
                        YBL_label == "2006"~ "2000s/10s" ,
                        YBL_label == "2007"~ "2000s/10s" ,
                        YBL_label == "2008"~ "2000s/10s",
                        YBL_label == "2009" ~ "2000s/10s",
                               YBL_label == "2010" ~ "2000s/10s",
                               YBL_label == "2011" ~ "2000s/10s",
                               YBL_label == "2012" ~ "2000s/10s",
                               YBL_label == "2013" ~ "2000s/10s",
                               YBL_label == "2014" ~ "2000s/10s",
                               YBL_label == "2015" ~ "2000s/10s",
                               YBL_label == "2016" ~ "2000s/10s",
                               YBL_label == "2017" ~ "2000s/10s",
                               YBL_label == "2018" ~ "2000s/10s",
                        TRUE ~"Other")) %>%
    
#Recode Journey to Work as a Categorical Variable
mutate(JWMNP_binned = case_when(
          JWMNP <15 ~ "Less Than 15 minutes",
          JWMNP <30 & JWMNP >15 | JWMNP == 15 ~ "15 - 30 minutes",
          JWMNP >30 & JWMNP <45 | JWMNP == 45 ~ "30 - 45 minutes", 
          JWMNP >45 & JWMNP <60 | JWMNP == 60 ~ "45 - 60 minutes",
          JWMNP >60 & JWMNP <75 | JWMNP == 75 ~ "60 - 75 minutes",
          TRUE ~ "No Commute Reported")) %>%
  
#Recode Race & Ethnicity Together
  #Carole gave me a great note on how to use the RAC1p & HISP variables instead of the RAC1P_label & HISP_labels to clean up this code. I have not had time to do so, but will do soon. 
  
  mutate(race_ethn = case_when(
    
    #White
   RAC1P_label == "White alone" & HISP_label == "Not Spanish/Hispanic/Latino" ~ "1 White (NH)",
   RAC1P_label == "White alone" & HISP_label != "Not Spanish/Hispanic/Latino" ~ "White (Hisp)",
   
   #Native American (inc Alaska Native)
   RAC1P_label == "American Indian alone" & HISP_label == "Not Spanish/Hispanic/Latino" ~ "Native American (NH)",
   RAC1P_label == "American Indian alone" & HISP_label != "Not Spanish/Hispanic/Latino" ~"Other (Hisp)",
   RAC1P_label == "American Indian and Alaska Nativeunique(R) tribes specified; or American Indian or Alaska Native, not specified and no other races" & HISP_label == "Not Spanish/Hispanic/Latino" ~ "Native American (NH)",
   RAC1P_label == "American Indian and Alaska Native tribes specified; or American Indian or Alaska Native, not specified and no other races" & HISP_label != "Not Spanish/Hispanic/Latino"~ "Other (Hisp)",
   RAC1P_label == "Alaska Native alone" & HISP_label == "Not Spanish/Hispanic/Latino" ~ "Native American (NH)",
   RAC1P_label == "Alaska Native alone" & HISP_label != "Not Spanish/Hispanic/Latino" ~"Other (Hisp)",
   
   #African American or Black
    RAC1P_label == "Black or African American alone" & HISP_label == "Not Spanish/Hispanic/Latino" ~ "Black (NH)",
    RAC1P_label == "Black or African American alone" & HISP_label != "Not Spanish/Hispanic/Latino" ~ "Other (Hisp)",
   
   #Asian
   RAC1P_label =="Asian alone" & HISP_label == "Not Spanish/Hispanic/Latino" ~ "Asian (NH)",
   RAC1P_label =="Asian alone" & HISP_label != "Not Spanish/Hispanic/Latino" ~ "Other (Hisp)",
   
   #Some Other Race Alone & Multiracial 
   
   RAC1P_label == "Some Other Race alone" & HISP_label == "Not Spanish/Hispanic/Latino" ~ "Other Race or Multiracial (NH)",
   RAC1P_label == "Some Other Race alone" & HISP_label != "Not Spanish/Hispanic/Latino"~ "Other (Hisp)",
   RAC1P_label == "Two or More Races" & HISP_label == "Not Spanish/Hispanic/Latino" ~ "Other Race or Multiracial (NH)",
   RAC1P_label == "Two or More Races" & HISP_label != "Not Spanish/Hispanic/Latino"~ "Other (Hisp)",
   
   #Native Hawaiian, Pacific Islander --> Coded as Other Race
   RAC1P_label == "Native Hawaiian and Other Pacific Islander alone" & HISP_label == "Not Spanish/Hispanic/Latino" ~ "Other Race or Multiracial (NH)",
   RAC1P_label == "Native Hawaiian and Other Pacific Islander alone" & HISP_label != "Not Spanish/Hispanic/Latino" ~ "Other (Hisp)", 
   
   # Other
   TRUE ~ "Other"))%>%
  
  

dplyr::select(HINCP, race_ethn, RAC1P, HISP, JWMNP_binned, NP, PUMA, when_built, AGEP, bld_type, PINCP, BLD_label)
```





##### Exploring DataSet
```{r}
# 4 figures arranged in 2 rows and 2 columns

#Explore Race and Ethnicity Variables 

r_e <- ggplot(assignment5_vars, aes(x = race_ethn)) +
  geom_bar(fill="sienna3", alpha=.5) +
   theme(axis.text.x = element_text(angle = 90)) +
   scale_x_discrete(name="Race & Ethnicity") +
    scale_y_continuous(name= "#Survey Respondants",
                       breaks = seq(0,8000, by = 2000),
                     labels = paste(seq(0,8000, by = 2000),
                     "", sep = "")) +
  coord_flip()+
  theme_classic()



#Explore Building Type

bld <- ggplot(assignment5_vars, aes(x =bld_type)) +
  geom_bar(fill="sienna3", alpha =.5) +
   theme(axis.text.x = element_text(angle = 90)) +
   scale_x_discrete(name="Home Type") +
    scale_y_continuous(name= "# Survey Respondants",
                       breaks = seq(0,8000, by = 2000),
                     labels = paste(seq(0,8000, by = 2000),
                     "", sep = "")) +
  coord_flip() +
  theme_classic()




# Explore Decade Home Was Built
dev <- ggplot(assignment5_vars, aes(x = when_built)) +
  geom_bar(fill= "sienna3", alpha=.5) +
   theme(axis.text.x = element_text(angle = 90)) +
  scale_x_discrete(name="Decade structure was built") +
    scale_y_continuous(name= "# Survey Respondants",
                       breaks = seq(0,8000, by = 2000),
                     labels = paste(seq(0,8000, by = 2000),
                     "", sep = "")) +
  coord_flip() +
  theme_classic()

# Plot Together

grid.arrange(r_e,dev, bld, ncol=2, nrow=2)

```

##### Compare to Rest of New Mexico
Putting this here so I can take a look of how the Bernallilo County Specific data compares to New Mexico overall. (Note --> this original data comes form before the point when I mutated the bld variable into a binary)
```{r}
# 4 figures arranged in 2 rows and 2 columns

#Explore Race and Ethnicity Variables 

r_e <- ggplot(assignment4_vars, aes(x = race_ethn)) +
  geom_bar(fill="royalblue", alpha=.5) +
   theme(axis.text.x = element_text(angle = 90)) +
   scale_x_discrete(name="Race & Ethnicity") +
    scale_y_continuous(name= "#Survey Respondants",
                       breaks = seq(0,8000, by = 2000),
                     labels = paste(seq(0,8000, by = 2000),
                     "", sep = "")) +
  coord_flip()+
  theme_classic()



#Explore Building Type

bld <- ggplot(assignment4_vars, aes(x =bld_type)) +
  geom_bar(fill="royalblue", alpha =.5) +
   theme(axis.text.x = element_text(angle = 90)) +
   scale_x_discrete(name="Home Type") +
    scale_y_continuous(name= "# Survey Respondants",
                       breaks = seq(0,8000, by = 2000),
                     labels = paste(seq(0,8000, by = 2000),
                     "", sep = "")) +
  coord_flip() +
  theme_classic()




# Explore Decade Home Was Built
dev <- ggplot(assignment4_vars, aes(x = when_built)) +
  geom_bar(fill= "royalblue", alpha=.5) +
   theme(axis.text.x = element_text(angle = 90)) +
  scale_x_discrete(name="Decade structure was built") +
    scale_y_continuous(name= "# Survey Respondants",
                       breaks = seq(0,8000, by = 2000),
                     labels = paste(seq(0,8000, by = 2000),
                     "", sep = "")) +
  coord_flip() +
  theme_classic()

# Plot Together

grid.arrange(r_e,dev, bld, ncol=2, nrow=2)

```



## **Model** 

Below is a model for Household Income (dependent variable) that takes into consideration When the Structure/Home was built, Race&Ethnicity of the respondent, building type, and age of respondent. 


The base cases are set to:

*Race/Ethnicity:* White (NH) 
*Home Type:* One family home, detached
*decade constructed*: Pre-1940s


## MODEL 1: Baseline
```{r}
model <- lm(HINCP ~ when_built + race_ethn + bld_type + AGEP, data =assignment5_vars)
summary(model)
```


#####  **Analysis:** 
In this model, I am looking at how Household Income varies with race/ethnicity, the decade a structure was built, the type of home it is and the age of the individual. The population I am looking at is a sample of individuals in Bernallilo who have reported non-negative Household Income.

The R-Squared is .0992 which indicates that around 9.9% of the variablility in income (the dependent variable) can be explained by variablity in the independent variables (race, decade home/structure developed, age of individual, race & ethnicity).



## MODEL 2: Baseline
```{r}
model <- lm(HINCP ~ when_built + race_ethn + AGEP + bld_type + when_built:bld_type + race_ethn:bld_type + AGEP:bld_type , data =assignment5_vars)
summary(model)
```



## MODEL 3: What type of building do you live in? 

**Question for Grader, I was interested in doing this type of regression, but didn't have a good sense of how I could do it. I feel I have a moderate understanding of what log-odds (the outputs) would be, but not how the code would look. Online I was able to deduce that I probably wanted glm() with family = binomial, but Im running into the following error. 

```{r}
fit <- glm(bld_type ~ when_built + race_ethn + HINCP, family =binomial, data =assignment5_vars)
summary(glm.fit)
```


## MODEL 4: What is your age based on Personal Income, Building Type, Race & Ethnicity? 

```{r}
model_4 <- lm(PINCP ~ AGEP + race_ethn + bld_type, data=assignment4_vars)
summary(model_4)

```









## **R Cheat Sheet, References & Troubleshooting**
Hello! I see this area of my assignment as predominantly a resource for myself as I learn R and as a resource to R if I ever need to return after a hiatus (and have forgotten everything I know). 

Feel free to look through, but there is no need to grade anything in this section. 

R Collaborative Flowchart: https://miro.com/app/board/o9J_klc5-mA=/


** Sage's Troubleshooting Checklist** <br/>
0. Breathe. <br/>
1. Is everything spelled/cApiTAlized correctly? <br/>
2. Count your parentheses(), commas, and "quotes" <br/>
    2.1 Check poles %>%, | <br/>
3. Have you run the R chunks that are before the chunk with your error. <br/>
5. What is the last thing you changed? Did you make sure you changed it in ALL the places it needs to be changed?<br/>
6. Breathe. Maybe get a glass of water.  <br/>
7. Type in the ?function() into the Console <br/>
8. Do a Google search for "R Markdown" + Your Problem <br/>
9. Try retyping the function from scratch.
10. Try copying and pasting sections in another R Chunk --> Isolate the Problem <br/>
11. Phone a friend. <br/>

**Common Errors:** <br/>
-If you are having a function not found error, check whether or not you have run your libraries. <br/>
-YAML error, check the very beginning of your code
- 

**If you want to see the values of a variable as they appear in your dataset**
#Race <br/>
#unique(household_data$RAC1P_label) <br/>
#Hispanic <br/>
#unique(household_data$HISP_label) <br/>

### References

**For General R**
R is for Data Science
https://r4ds.had.co.nz/index.html

Data Wrangling Cheat Sheet
https://rstudio.com/wp-content/uploads/2015/02/data-wrangling-cheatsheet.pdf

*formatting*
https://rstudio.com/wp-content/uploads/2015/02/rmarkdown-cheatsheet.pdf

*For GGPLOT**
Top 50 Graph Types
http://r-statistics.co/Top50-Ggplot2-Visualizations-MasterList-R-Code.html#Violin%20Plot

GGplot Cheat Sheet
https://rstudio.com/wp-content/uploads/2015/03/ggplot2-cheatsheet.pdf

Color Pallets
https://www.datanovia.com/en/blog/ggplot-colors-best-tricks-you-will-love/#predefined-ggplot-color-palettes


Look into Wes Anderson Themes, WSJ, Economist

**Number Crunching**

Another Way of Pulling Summary <br/>
#mean(household_data$HINCP) <br/>
#quantile(household_data$HINCP) <br/>
#sd(household_data$HINCP) <br/>

Simple Explanation of Dsitributions: 
https://nezumisa.wordpress.com/2013/06/03/different-types-of-distributions/


